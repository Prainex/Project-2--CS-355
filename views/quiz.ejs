<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel='stylesheet' href='/stylesheets/quiz.css' />
</head>
<body>
    <div class="header">
        <h1>Question 1</h1>
        <div class="timer">30</div>
    </div>

    <div class="container">
        <h1>This is a question?</h1>
        <form action="">
            <label class="option">
                <input type="radio" id="optionA" name="answer" value="A">
                <p>Option A</p>
            </label>
            <label class="option">
                <input type="radio" id="optionB" name="answer" value="B">
                <p>Option B</p>
            </label>
            <label class="option">
                <input type="radio" id="optionC" name="answer" value="C">
                <p>Option C</p>
            </label>
            <label class="option">
                <input type="radio" id="optionD" name="answer" value="D">
                <p>Option D</p>
            </label>
            <button id="next-button" type="button">Next</button>
        </form>
    </div>

    <div class="container-2">
        <h1>Thanks for taking the quiz</h1>
        <form action="/auth/login/submit/userOptions/quiz" method="POST">
            <input id="result-btn" type="submit" value="View Result">
        </form>        
    </div>
    
    

    <h1>Nothing goes here</h1>
    
    <script>
        const questions = <%- JSON.stringify(questions) %>;
        const time_limit = <%- time_limit %>;

        let actual_answers = [];
        questions.forEach((item) => {
            actual_answers.push(item.answer);
        });

        let user_response = [];
        let correct_response = [];

        const questionElement = document.querySelector('.container > h1');
        const options = document.querySelectorAll('.option input');  // Query input elements for options
        const nextButton = document.getElementById('next-button');
        const headerQuestion = document.querySelector('.header > h1');
        const timerElement = document.querySelector('.timer');
        document.querySelector('.container-2').style.display = 'none';

        let currentQuestionIndex = 0;
        let timeLeft = time_limit;
        let timerInterval;

        function updateTimerDisplay() {
            timerElement.textContent = timeLeft;
        }

        function startTimer() {
            timeLeft = time_limit;
            updateTimerDisplay();

            timerInterval = setInterval(() => {
                timeLeft--;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerElement.textContent = "0";
                    nextQuestion();
                } else {
                    updateTimerDisplay();
                }
            }, 1000);
        }

        function recordResponse() {
            let selectedOption = null;

            options.forEach((option) => {
                if (option.checked) {
                    selectedOption = option.value; 
                }
            });

            if (selectedOption === null) {
                user_response.push("no answer"); 
            } else {
                user_response.push(selectedOption); 
            }
        }

        function loadQuestion() {
            let question = questions[currentQuestionIndex];
            questionElement.textContent = question.question;
            headerQuestion.textContent = `Question ${currentQuestionIndex + 1}`;

            options[0].nextElementSibling.textContent = question.A;
            options[1].nextElementSibling.textContent = question.B;
            options[2].nextElementSibling.textContent = question.C;
            options[3].nextElementSibling.textContent = question.D;

            options.forEach((option) => {
                option.checked = false;
            });

            startTimer();
        }

        function nextQuestion() {
            recordResponse(); 

            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } 
            
            else {
                clearInterval(timerInterval);
                document.querySelector('.container').style.display = 'none'; 
                document.querySelector('.container-2').style.display = 'flex';
                
            }
        }

        nextButton.addEventListener('click', (e) => {
            e.preventDefault();
            clearInterval(timerInterval);
            nextQuestion();
        });

        document.getElementById('result-btn').addEventListener('click', () => {
            window.location.href = '/results';
        });


        loadQuestion();
    </script>
</body>
</html>

